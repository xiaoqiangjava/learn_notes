<center><h1>Mysql索引学习笔记</h1></center>

##### 为什么要使用索引？

* 索引能极大减少存储引擎需要扫描的数据量
* 索引可以把随机IO编程顺序IO
* 索引可以帮助我们在分组，排序等操作时，避免使用临时表


##### MySQL中使用B+Tree作为索引数据结构

* B+Tree与B-Tree的区别：
	* B+ 节点关键字搜索采用闭合区间
	* B+ 非叶子节点不会保存数据的相关信息，只保存关键字和子节点的引用
	* B+ 关键字对应的数据保存在叶子节点中
	* B+ 叶子节点时顺序排列的，并且相邻节点具有顺序引用的关系

* 为什么选择B+ Tree作为MySQL索引的数据结构 ？
	* B+ 树是B 树的变种多路平衡查找树，它拥有B 树的优势
	* B+ 树扫库扫表能力更强，因为B+ 树中的数据都存在叶子节点上面
	* B+ 树的排序能力更强，因为B+ 树的叶子节点时顺序排列的，并且相邻节点具有顺序引用关系
	* B+ 树的查询效率更加的稳定，因为B树可能在第一次就查到了想要的数据，也有可能在最后一次查到想要的数据，查询数据想要的时间不稳定，而B+树，不管怎么样，最后都会查询到叶子节点才能找到数据，查询时间稳定。

##### MySQL引擎：InnoDB和MyISAM

* InnoDB和MyISAM都有一个表结构文件.frm, 但是数据文件和索引文件后缀不同，可以同下面的语句查到数据保存位置

		show variables like '%datadir%';
* InnoDB的数据保存在table_name.ibd文件中，是以主键为索引来组织数据的存储，数据保存在索引的叶子节点上，如果创建表的时候没有指定主键索引，则会默认生成一个int类型的索引。这就是聚集索引，即数据 库表行中数据的物理顺序和索引的逻辑顺序相同。在InnoDB中，只有主键是聚集索引，其他的索引都是非聚集索引。非主键索引(辅助索引)的叶子节点中存储的是主键索引的值，然后再到主键索引中查找需要的数据。没有在辅助索引中保存磁盘数据的引用主要是考虑到数据修改时，不需要维护辅助索引对应的数据。
* MyISAM的数据保存在table_name.MYD文件中，索引保存在table_name.MYI文件中，MyISAM与InnoDB不同，不管是否是辅助索引，他的叶子节点中都保存了数据在磁盘中的引用地址。

##### 索引的创建原则

* 列的离散型：count(distinct col)/count(col), 离散型越高，选择性就越好，选择性越好，越适合建索引。
* 最左匹配原则：对索引中关键字进行对比，一定是从做往右依次进行，且不可跳过。按照该原则，当选择型很差的时候，查询优化器会放弃使用索引，进行全表扫描。
* 最少空间原则：列占用的空间越小，可以存储的关键字就越多，B+树就越胖


#####  联合索引：多个列联合到一起，组成一个缩影，同样遵循最左匹配原则。联合索引选择原则：
	
* 经常使用的列优先(最左匹配原则)
* 选择性高的列优先(离散性高原则)
* 宽度小的列优先(最少空间原则)

##### 覆盖索引

* 查询的列可以通过索引节点中的关键字直接返回，则该索引称为覆盖索引，覆盖索引可以减少磁盘IO，将随机IO变为顺序IO，可以提高查询性能。

		// 比如有一个联合索引
		create index idx_name_phone on people(name, phone);
		// 当查询的字段为name和phone时，因为存在联合索引，数据直接通过节点关键字返回，不需要扫描子节点，称为覆盖索引
		select name, phone from people where name = 'xiaoqiang'; // 联合索引遵从最左匹配原则
		// 一条查询语句只会选择一个索引来执行查询，当存在多个索引时，主键索引肯定是最先被选择，所以当通过id查询时不会使用上面的索引，因此该查询不会用到覆盖索引
		select name, phone from people where id = 100;

* 一个数据表中不要创建太多索引，因为一条查询语句只会选择一个索引来执行查询

##### 总结

* 索引列的长度能少则少，磁盘块中存储的关键字越多，B+树中路树越多，磁盘IO能力越强，因为一次可以读取多个关键字。
* 索引一定不是越多越好，越全越好，一定是建合适的
* 匹配列前缀可以用到索引(有可能用到，也有可能不会用到索引)，因为索引遵从最左匹配原则，但是索引遵从离散性原则，当like '999%'的离散性很好时，会使用索引，如果离散性不好，查询优化器会选择全表扫描。like %999, %999%肯定不会用到索引。
* where条件中not in 和 <>操作无法使用索引。
* 匹配范围值，order by, group by也可用到索引。
* 所用指定列查询，只返回自己想要的数据列，少用select * 。
* 联合索引中，如果不是按照索引最左列开始查找，无法使用索引，因为最左原则不会跳过任何字符。
* 联合索引中精确匹配最左前列并范围匹配另外一列，可以用到索引。
* 联合索引中，如果查询中有某个列的范围查询，则其右边的所有列都无法使用索引。
* 使用EXPLAIN关键字查看SQL执行计划

		EXPLAIN select * from people where name line 'xiao%' \G;
		